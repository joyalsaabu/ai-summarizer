<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment Processing & Fraud Detection System v2</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0a0a0a; /* Darker background */
        }
        .status-dot {
            height: 10px;
            width: 10px;
            border-radius: 50%;
            display: inline-block;
        }
        .pulsing {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .log-entry {
            transition: background-color 0.3s ease;
        }
        .glass-panel {
            background: rgba(23, 23, 23, 0.6); /* Semi-transparent dark background */
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
    </style>
</head>
<body class="bg-gray-900 text-white antialiased">

    <div class="container mx-auto p-4 md:p-8">
        <!-- Header -->
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-cyan-400">Payment Processing & Fraud Detection System</h1>
            <p class="text-gray-400 mt-2">A simulation of a microservices architecture with Core Java, Spring Boot, and Python.</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <!-- Left Column: Wallet & New Transaction -->
            <div class="lg:col-span-1 space-y-8">
                <!-- User Wallet -->
                <div class="glass-panel rounded-2xl p-6 shadow-lg">
                    <h2 class="text-xl font-semibold text-gray-200 mb-4">User Wallet Service</h2>
                    <div class="flex items-center justify-between">
                        <span class="text-gray-400">Current Balance</span>
                        <span id="walletBalance" class="text-2xl font-bold text-green-400">$10,000.00</span>
                    </div>
                </div>

                <!-- New Transaction -->
                <div class="glass-panel rounded-2xl p-6 shadow-lg">
                    <h2 class="text-xl font-semibold text-gray-200 mb-4">Initiate New Payment</h2>
                    <form id="paymentForm" class="space-y-4">
                        <div>
                            <label for="recipient" class="block text-sm font-medium text-gray-400">Recipient</label>
                            <input type="text" id="recipient" name="recipient" class="mt-1 block w-full bg-gray-800 border-gray-600 rounded-md shadow-sm focus:ring-cyan-500 focus:border-cyan-500 text-white p-3" placeholder="e.g., 'Quantum Computing Inc.'" required>
                        </div>
                        <div>
                            <label for="amount" class="block text-sm font-medium text-gray-400">Amount ($)</label>
                            <input type="number" id="amount" name="amount" class="mt-1 block w-full bg-gray-800 border-gray-600 rounded-md shadow-sm focus:ring-cyan-500 focus:border-cyan-500 text-white p-3" placeholder="e.g., 150.00" required min="0.01" step="0.01">
                        </div>
                        <button type="submit" id="submitBtn" class="w-full bg-cyan-600 hover:bg-cyan-700 text-white font-bold py-3 px-4 rounded-lg transition duration-300 ease-in-out transform hover:scale-105 shadow-lg">
                            Submit Payment
                        </button>
                    </form>
                </div>
            </div>

            <!-- Right Column: System Status & Logs -->
            <div class="lg:col-span-2 space-y-8">
                <!-- System Status -->
                <div class="glass-panel rounded-2xl p-6 shadow-lg">
                    <h2 class="text-xl font-semibold text-gray-200 mb-4">Live System Monitor</h2>
                    <div id="statusContainer" class="space-y-3 text-gray-300 h-64 overflow-y-auto pr-2">
                        <p class="text-center text-gray-500 pt-20">System is idle. Initiate a payment to begin.</p>
                    </div>
                </div>

                <!-- Transaction Log -->
                <div class="glass-panel rounded-2xl p-6 shadow-lg">
                    <h2 class="text-xl font-semibold text-gray-200 mb-4">Transaction Logging Service (PostgreSQL)</h2>
                    <div class="overflow-x-auto">
                        <table class="min-w-full">
                            <thead class="border-b border-gray-700">
                                <tr>
                                    <th class="py-3 text-left text-sm font-semibold text-gray-400">Timestamp</th>
                                    <th class="py-3 text-left text-sm font-semibold text-gray-400">Recipient</th>
                                    <th class="py-3 text-left text-sm font-semibold text-gray-400">Amount</th>
                                    <th class="py-3 text-left text-sm font-semibold text-gray-400">Status</th>
                                </tr>
                            </thead>
                            <tbody id="transactionLog">
                                <!-- Log entries will be added here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // DOM Elements
        const form = document.getElementById('paymentForm');
        const submitBtn = document.getElementById('submitBtn');
        const walletBalanceEl = document.getElementById('walletBalance');
        const statusContainer = document.getElementById('statusContainer');
        const transactionLog = document.getElementById('transactionLog');

        // Initial State
        let walletBalance = 10000.00;
        let isProcessing = false;

        // --- Helper Functions ---

        /**
         * Formats a number as a currency string.
         * @param {number} amount - The number to format.
         * @returns {string} - The formatted currency string.
         */
        const formatCurrency = (amount) => {
            return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(amount);
        };

        /**
         * Updates the status monitor UI with a new message and style.
         * @param {string} message - The status message to display.
         * @param {string} colorClass - The Tailwind CSS color class for the status dot.
         * @param {boolean} pulsing - Whether the dot should have a pulse animation.
         */
        const updateStatus = (message, colorClass, pulsing = true) => {
            const pulseClass = pulsing ? 'pulsing' : '';
            const newStatus = document.createElement('div');
            newStatus.className = 'flex items-center space-x-3 p-2 bg-gray-800/50 rounded-lg';
            newStatus.innerHTML = `
                <span class="status-dot ${colorClass} ${pulseClass}"></span>
                <span>${message}</span>
            `;
            statusContainer.appendChild(newStatus);
            statusContainer.scrollTop = statusContainer.scrollHeight;
        };
        
        /**
         * Adds a new entry to the transaction log table.
         * @param {object} transaction - The transaction details.
         * @param {string} status - The final status of the transaction.
         * @param {string} statusColorClass - The Tailwind CSS color class for the status text.
         */
        const addLogEntry = (transaction, status, statusColorClass) => {
            const now = new Date();
            const timestamp = now.toLocaleTimeString();
            const newRow = document.createElement('tr');
            newRow.className = 'log-entry border-b border-gray-800';
            newRow.innerHTML = `
                <td class="py-3 text-gray-400">${timestamp}</td>
                <td class="py-3 text-gray-200">${transaction.recipient}</td>
                <td class="py-3 text-gray-200">${formatCurrency(transaction.amount)}</td>
                <td class="py-3 font-medium ${statusColorClass}">${status}</td>
            `;
            transactionLog.prepend(newRow);
        };

        // --- Core Logic ---

        /**
         * Simulates a real-time fraud detection check using a Python/Scikit-learn model.
         * @param {number} amount - The transaction amount.
         * @returns {Promise<boolean>} - A promise that resolves to true (approved) or false (flagged).
         */
        const runFraudDetection = (amount) => {
            return new Promise(resolve => {
                setTimeout(() => {
                    // Simple rule: amounts over $1,000 are flagged as suspicious
                    // This simulates the logic from the Scikit-learn model.
                    resolve(amount <= 1000);
                }, 1500); // Simulate network latency for ML model check
            });
        };

        /**
         * Simulates the entire payment processing lifecycle.
         * @param {object} transaction - The transaction details (recipient, amount).
         */
        const processTransaction = async (transaction) => {
            isProcessing = true;
            submitBtn.disabled = true;
            submitBtn.textContent = 'Processing...';
            statusContainer.innerHTML = ''; // Clear previous status

            // 1. Authorization Service (Java/Spring Boot)
            updateStatus('Contacting Authorization Service (Java/Spring Boot)...', 'bg-yellow-400');
            await new Promise(res => setTimeout(res, 1000));
            
            if (transaction.amount > walletBalance) {
                updateStatus('Authorization Failed: Insufficient Funds', 'bg-red-500', false);
                addLogEntry(transaction, 'Failed', 'text-red-400');
                resetForm();
                return;
            }
            updateStatus('Authorization Successful', 'bg-green-400', false);

            // 2. Fraud Detection Module (Python/Scikit-learn)
            updateStatus('Analyzing via Fraud Detection REST API (Python/Scikit-learn)...', 'bg-yellow-400');
            const isApproved = await runFraudDetection(transaction.amount);

            if (!isApproved) {
                updateStatus('Fraud Alert: Transaction Flagged by ML Model', 'bg-red-500', false);
                addLogEntry(transaction, 'Flagged', 'text-yellow-400');
                resetForm();
                return;
            }
            updateStatus('Fraud Check Passed', 'bg-green-400', false);

            // 3. Clearing Service
            updateStatus('Submitting to Clearing House...', 'bg-yellow-400');
            await new Promise(res => setTimeout(res, 1500));
            updateStatus('Transaction Cleared', 'bg-green-400', false);

            // 4. Settlement & Logging
            updateStatus('Settling Funds & Persisting to PostgreSQL...', 'bg-yellow-400');
            await new Promise(res => setTimeout(res, 1500));
            
            // Update wallet balance
            walletBalance -= transaction.amount;
            walletBalanceEl.textContent = formatCurrency(walletBalance);
            
            updateStatus('Payment Settled & Complete!', 'bg-cyan-400', false);
            addLogEntry(transaction, 'Completed', 'text-green-400');
            
            resetForm();
        };
        
        /**
         * Resets the form and processing state.
         */
        const resetForm = () => {
            isProcessing = false;
            submitBtn.disabled = false;
            submitBtn.textContent = 'Submit Payment';
            form.reset();
        };

        // --- Event Listener ---
        form.addEventListener('submit', (e) => {
            e.preventDefault();
            if (isProcessing) return;

            const recipient = e.target.recipient.value;
            const amount = parseFloat(e.target.amount.value);
            
            if (!recipient || isNaN(amount) || amount <= 0) {
                // A more user-friendly notification than alert()
                const originalColor = submitBtn.style.backgroundColor;
                submitBtn.textContent = 'Invalid Input';
                submitBtn.style.backgroundColor = '#ef4444'; // Red
                setTimeout(() => {
                    submitBtn.textContent = 'Submit Payment';
                    submitBtn.style.backgroundColor = originalColor;
                }, 2000);
                return;
            }

            const transaction = { recipient, amount };
            processTransaction(transaction);
        });
    </script>
</body>
</html>
